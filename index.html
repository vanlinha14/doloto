<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√≤ L√¥ T√¥</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>D√≤ L√¥ T√¥</h1>
            <div class="header-actions">
                <button class="btn-icon" onclick="showHistory()" title="L·ªãch s·ª≠">üìú</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="tickets" onclick="switchTab('tickets')">V√© c·ªßa t√¥i</button>
                <button class="tab" data-tab="draw" onclick="switchTab('draw')">D√≤ v√©</button>
            </div>

            <!-- Tickets Tab -->
            <div id="tickets-tab" class="tab-content active">
                <div class="section-header">
                    <h2>Danh s√°ch v√©</h2>
                    <button class="btn-primary" onclick="showCreateTicketModal()">+ T·∫°o v√© m·ªõi</button>
                </div>
                <div id="tickets-list" class="tickets-list"></div>
                <div id="empty-tickets" class="empty-state" style="display: none;">
                    <p>Ch∆∞a c√≥ v√© n√†o</p>
                    <p class="hint">Nh·∫•n "T·∫°o v√© m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                </div>
            </div>

            <!-- Draw Tab -->
            <div id="draw-tab" class="tab-content">
                <div class="draw-container">
                    <!-- Number Input -->
                    <div class="draw-input-section">
                        <h3>Nh·∫≠p s·ªë ƒë√£ quay</h3>
                        <div class="draw-input-row">
                            <input type="number" id="draw-number-input" min="1" max="90" placeholder="1-90">
                            <button class="btn-primary" onclick="addDrawnNumber()">Th√™m</button>
                        </div>

                        <!-- Toggle Number Pad -->
                        <div class="number-pad-toggle">
                            <button class="btn-toggle" id="toggle-numpad-btn" onclick="toggleNumberPad()">
                                <span id="numpad-toggle-icon">‚ñº</span> B·∫£ng s·ªë 1-90
                            </button>
                        </div>

                        <!-- Number Pad (collapsible) -->
                        <div class="number-pad-wrapper" id="number-pad-wrapper">
                            <div class="number-pad" id="number-pad"></div>
                        </div>

                        <!-- Drawn Numbers Display -->
                        <div class="drawn-numbers-section">
                            <div class="drawn-numbers-header">
                                <span>S·ªë ƒë√£ quay: <strong id="drawn-count">0</strong></span>
                                <button class="btn-secondary btn-small" onclick="clearAllDrawnNumbers()">X√≥a h·∫øt</button>
                            </div>
                            <div id="drawn-numbers-display" class="drawn-numbers-chips"></div>
                        </div>
                    </div>

                    <!-- Tickets being checked -->
                    <div class="draw-tickets-section">
                        <h3>V√© ƒëang d√≤</h3>
                        <div id="draw-tickets-list" class="draw-tickets-list"></div>
                        <div id="empty-draw-tickets" class="empty-state" style="display: none;">
                            <p>Ch∆∞a c√≥ v√© n√†o ƒë·ªÉ d√≤</p>
                            <p class="hint">H√£y t·∫°o v√© tr∆∞·ªõc</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Ticket Modal -->
    <div id="create-ticket-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>T·∫°o v√© m·ªõi</h2>
                <button class="btn-close" onclick="closeCreateTicketModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Ch·ªçn lo·∫°i v√© -->
                <div class="ticket-type-selector">
                    <label>Ch·ªçn lo·∫°i v√©:</label>
                    <div class="type-options">
                        <button class="type-btn active" data-type="classic" onclick="selectTicketType('classic')">
                            <span class="icon">üé´</span>
                            <span>C·ªï ƒëi·ªÉn (90 s·ªë)</span>
                        </button>
                        <button class="type-btn" data-type="5x5" onclick="selectTicketType('5x5')">
                            <span class="icon">‚≠ê</span>
                            <span>ƒê∆°n gi·∫£n (5x5)</span>
                        </button>
                    </div>
                </div>

                <div class="create-options">
                    <button class="create-option" onclick="showManualCreate()">
                        <span class="icon">‚úèÔ∏è</span>
                        <span>Nh·∫≠p th·ªß c√¥ng</span>
                    </button>
                    <button class="create-option" onclick="goToCameraPage()">
                        <span class="icon">üì∑</span>
                        <span>Ch·ª•p ·∫£nh v√©</span>
                    </button>
                    <button class="create-option" onclick="goToUploadPage()">
                        <span class="icon">üì§</span>
                        <span>Upload ·∫£nh v√©</span>
                    </button>
                    <button class="create-option" onclick="createRandomTicket()">
                        <span class="icon">üé≤</span>
                        <span>T·∫°o ng·∫´u nhi√™n</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Create Modal -->
    <div id="manual-create-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="manual-create-title">T·∫°o v√© th·ªß c√¥ng</h2>
                <button class="btn-close" onclick="closeManualCreateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="ticket-name">T√™n v√©</label>
                    <input type="text" id="ticket-name" placeholder="Nh·∫≠p t√™n v√©">
                </div>

                <p class="hint" id="manual-create-hint">Nh·∫•n v√†o √¥ ƒë·ªÉ nh·∫≠p s·ªë. M·ªói h√†ng ph·∫£i c√≥ ƒë√∫ng 5 s·ªë.</p>

                <!-- Nh·∫≠p h√†ng lo·∫°t -->
                <div class="bulk-input-section">
                    <button class="btn-secondary btn-small" onclick="toggleBulkInput()" id="bulk-input-toggle">
                        üìù Nh·∫≠p h√†ng lo·∫°t
                    </button>
                    <div id="bulk-input-container" style="display: none;">
                        <textarea id="bulk-input-text" placeholder="Nh·∫≠p s·ªë theo d√≤ng, m·ªói d√≤ng l√† 1 h√†ng c·ªßa v√©
V√≠ d·ª•:
1 2 3 4 5
6, 7, 8, 9, 10
11; 12; 13; 14; 15"></textarea>
                        <div class="bulk-input-actions">
                            <button class="btn-secondary btn-small" onclick="clearBulkInput()">X√≥a</button>
                            <button class="btn-primary btn-small" onclick="applyBulkInput()">√Åp d·ª•ng</button>
                        </div>
                        <p class="hint">H·ªó tr·ª£: d·∫•u c√°ch, d·∫•u ph·∫©y, d·∫•u ch·∫•m ph·∫©y. M·ªói d√≤ng = 1 h√†ng v√©.</p>
                    </div>
                </div>

                <!-- Grid cho v√© c·ªï ƒëi·ªÉn -->
                <div id="classic-grid-section">
                    <div id="edit-ticket-grid" class="ticket-grid editable"></div>

                    <div id="column-ranges-info" class="column-ranges">
                        <p><strong>Ph·∫°m vi s·ªë theo c·ªôt:</strong></p>
                        <div class="ranges-row">
                            <span>C1: 1-9</span>
                            <span>C2: 10-19</span>
                            <span>C3: 20-29</span>
                            <span>C4: 30-39</span>
                            <span>C5: 40-49</span>
                            <span>C6: 50-59</span>
                            <span>C7: 60-69</span>
                            <span>C8: 70-79</span>
                            <span>C9: 80-90</span>
                        </div>
                    </div>

                    <!-- Quick numbers section - ch·ªçn nhanh -->
                    <div id="quick-numbers-section" class="quick-numbers-section" style="display: none;">
                        <p class="helper-hint">Ch·ªçn nhanh:</p>
                        <div class="quick-numbers"></div>
                    </div>
                </div>

                <!-- Grid cho v√© 5x5 -->
                <div id="5x5-grid-section" style="display: none;">
                    <div id="edit-ticket-grid-5x5" class="ticket-grid ticket-grid-5x5 editable"></div>

                    <div class="column-ranges">
                        <p><strong>L∆∞u √Ω:</strong> V√© 5x5 g·ªìm 2 khung, m·ªói khung 5x5. √î gi·ªØa (‚òÖ) kh√¥ng nh·∫≠p s·ªë. S·ªë kh√¥ng tr√πng trong c√πng 1 khung.</p>
                    </div>

                    <!-- Quick numbers section cho 5x5 -->
                    <div id="quick-numbers-section-5x5" class="quick-numbers-section" style="display: none;">
                        <p class="helper-hint">Ch·ªçn nhanh (1-90):</p>
                        <div class="quick-numbers quick-numbers-5x5"></div>
                    </div>
                </div>

                <div id="create-error" class="error-message" style="display: none;"></div>
                <div id="create-error-5x5" class="error-message" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeManualCreateModal()">H·ªßy</button>
                <button class="btn-primary" onclick="saveManualTicket()">L∆∞u v√©</button>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="camera-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Ch·ª•p ·∫£nh v√©</h2>
                <button class="btn-close" onclick="closeCameraModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="camera-section">
                    <div class="camera-container">
                        <video id="camera-video" autoplay playsinline></video>
                        <div class="camera-overlay">
                            <div class="camera-guide"></div>
                        </div>
                    </div>
                    <div class="camera-actions">
                        <button class="btn-secondary" onclick="switchCamera()">üîÑ ƒê·ªïi camera</button>
                        <button class="btn-primary btn-capture" onclick="capturePhoto()">üì∑ Ch·ª•p</button>
                    </div>
                    <p class="hint camera-hint">ƒê·∫∑t v√© l√¥ t√¥ trong khung v√† nh·∫•n Ch·ª•p</p>
                </div>

                <div id="camera-review-section" style="display: none;">
                    <img id="captured-image" alt="·∫¢nh ƒë√£ ch·ª•p">
                <div style="margin: 10px 0;">
                    <button class="btn-primary" style="width: 100%; background-color: #673AB7;" onclick="runCameraOCR()">
                        ‚ú® Nh·∫≠n di·ªán s·ªë t·ª± ƒë·ªông (OCR)
                    </button>
                </div>
                <p class="hint">Ki·ªÉm tra v√† nh·∫≠p s·ªë v√†o c√°c √¥. OCR t·ª± ƒë·ªông ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn.</p>

                    <div class="form-group">
                        <label for="camera-ticket-name">T√™n v√©</label>
                        <input type="text" id="camera-ticket-name" placeholder="Nh·∫≠p t√™n v√©">
                    </div>

                    <div id="camera-ticket-grid" class="ticket-grid editable"></div>

                    <div id="camera-cell-input-section" class="cell-input-section" style="display: none;">
                        <div class="cell-input-header">
                            <span id="camera-cell-position">H√†ng 1, C·ªôt 1</span>
                            <span id="camera-cell-range">S·ªë h·ª£p l·ªá: 1-9</span>
                        </div>
                        <div class="cell-input-row">
                            <input type="number" id="camera-cell-number-input" min="1" max="90">
                            <button class="btn-primary" onclick="setCameraCellNumber()">OK</button>
                            <button class="btn-secondary" onclick="clearCameraCellNumber()">X√≥a</button>
                        </div>
                        <div id="camera-quick-numbers" class="quick-numbers"></div>
                    </div>

                    <div id="camera-error" class="error-message" style="display: none;"></div>

                    <div class="upload-actions">
                        <button class="btn-secondary" onclick="retakePhoto()">üîÑ Ch·ª•p l·∫°i</button>
                        <button class="btn-primary" onclick="saveCameraTicket()">üíæ L∆∞u v√©</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Upload ·∫£nh v√©</h2>
                <button class="btn-close" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="upload-section">
                    <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                        <div class="upload-icon">üì§</div>
                        <p>Nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</p>
                        <p class="hint">H·ªó tr·ª£: JPG, PNG, GIF</p>
                    </div>
                    <input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                </div>

                <div id="upload-review-section" style="display: none;">
                    <img id="uploaded-image" alt="·∫¢nh ƒë√£ upload">
                <div style="margin: 10px 0;">
                    <button class="btn-primary" style="width: 100%; background-color: #673AB7;" onclick="runUploadOCR()">
                        ‚ú® Nh·∫≠n di·ªán s·ªë t·ª± ƒë·ªông (OCR)
                    </button>
                </div>
                <p class="hint">Ki·ªÉm tra v√† nh·∫≠p s·ªë v√†o c√°c √¥. OCR t·ª± ƒë·ªông ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn.</p>

                    <div class="form-group">
                        <label for="upload-ticket-name">T√™n v√©</label>
                        <input type="text" id="upload-ticket-name" placeholder="Nh·∫≠p t√™n v√©">
                    </div>

                    <div id="upload-ticket-grid" class="ticket-grid editable"></div>

                    <div id="upload-cell-input-section" class="cell-input-section" style="display: none;">
                        <div class="cell-input-header">
                            <span id="upload-cell-position">H√†ng 1, C·ªôt 1</span>
                            <span id="upload-cell-range">S·ªë h·ª£p l·ªá: 1-9</span>
                        </div>
                        <div class="cell-input-row">
                            <input type="number" id="upload-cell-number-input" min="1" max="90">
                            <button class="btn-primary" onclick="setUploadCellNumber()">OK</button>
                            <button class="btn-secondary" onclick="clearUploadCellNumber()">X√≥a</button>
                        </div>
                        <div id="upload-quick-numbers" class="quick-numbers"></div>
                    </div>

                    <div id="upload-error" class="error-message" style="display: none;"></div>

                    <div class="upload-actions">
                        <button class="btn-secondary" onclick="resetUpload()">üîÑ Ch·ªçn ·∫£nh kh√°c</button>
                        <button class="btn-primary" onclick="saveUploadTicket()">üíæ L∆∞u v√©</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>L·ªãch s·ª≠ d√≤ v√©</h2>
                <button class="btn-close" onclick="closeHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="history-list" class="history-list"></div>
                <div id="empty-history" class="empty-state" style="display: none;">
                    <p>Ch∆∞a c√≥ l·ªãch s·ª≠</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Dialog (supports multiple winners) -->
    <div id="win-dialog" class="modal win-modal">
        <div class="modal-content win-content">
            <div class="win-icon">üéâ</div>
            <h2>TH·∫ÆNG!</h2>
            <div id="win-message-list" class="win-message-list"></div>
            <button class="btn-primary btn-large" onclick="closeWinDialog()">OK</button>
        </div>
    </div>

    <!-- Near Win Dialog (supports multiple) -->
    <div id="near-win-dialog" class="modal near-win-modal">
        <div class="modal-content near-win-content">
            <div class="win-icon">‚ö°</div>
            <h2>S·∫ÆP TH·∫ÆNG!</h2>
            <div id="near-win-message-list" class="win-message-list"></div>
            <button class="btn-primary btn-large" onclick="closeNearWinDialog()">OK</button>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirm-dialog" class="modal">
        <div class="modal-content confirm-content">
            <h3 id="confirm-title">X√°c nh·∫≠n</h3>
            <p id="confirm-message"></p>
            <div class="confirm-actions">
                <button class="btn-secondary" onclick="closeConfirmDialog()">H·ªßy</button>
                <button class="btn-danger" id="confirm-btn" onclick="confirmAction()">X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
